// Alunos: Gustavo Weber e Carolina de Moraes

// Para funcionar, favor rodar: npm install node-fetch

// Para rodar: node "caminhoqueestiver/Seg_Info.mjs"

// Utilizado .mjs para não alterar pacotes do package.json

// js >> py


import fetch from 'node-fetch';
import { promises as dns } from 'dns';

const DOMAINS = ['uniftec.com.br', 'ftec.com.br'];

async function fetchSubdomains(domain) {
    const url = `https://api.hackertarget.com/hostsearch/?q=${domain}`;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`Erro na API: ${response.statusText}`);
        }
        const text = await response.text();
        const lines = text.split('\n');
        return lines.map(line => line.split(',')[0]);
    } catch (error) {
        console.error(`Falha ao buscar subdomínios para ${domain}:`, error);
        return [];
    }
}

async function resolveSubdomains(subdomains) {
    const results = [];
    for (const subdomain of subdomains) {
        try {
            const addresses = await dns.resolve(subdomain);
            results.push({ subdomain, addresses });
        } catch (error) {
            console.error(`Falha ao resolver ${subdomain}:`, error);
            results.push({ subdomain, addresses: [] });
        }
    }
    return results;
}

async function main() {
    for (const domain of DOMAINS) {
        console.log(`Buscando subdomínios para: ${domain}`);
        const subdomains = await fetchSubdomains(domain);
        if (subdomains.length > 0) {
            const resolvedSubdomains = await resolveSubdomains(subdomains);
            console.log(resolvedSubdomains);
        } else {
            console.log(`Nenhum subdomínio encontrado para: ${domain}`);
        }
    }
}

main();
